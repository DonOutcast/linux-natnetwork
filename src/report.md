## Part 1. Инструмент ipcalc
1. Поднять вирутальную машину ws1
![ws1](images/cron1.png)
- Устанавливаем ipcalc `sudo apt install ipcalc`
![ipcalc](images/cron2.png)
### 1.1. Сети и маски.
Определить и записать в отчет:
1. Адрес сети 192.167.38.54/13 
- 192.160.0.0/13
2. Перевод маски 255.255.255.0 в перфиксную и двоичнуюзапись
- /24
- 11111111.11111111.11111111. 00000000
3. Перевод /15 вобычную и двоичную
- 255.254.0.0
- 11111111.11111110.00000000. 00000000
4. Перевод 11111111.11111111.11111111.11110000 в обычную и перфиксную
- 255.255.255.240
-  /28
5. Минимальный и максимальный хост в сети 12.167.38.4 /8, 11111111.11111111.00000000.00000000, 255.255.254.0 и /4
- /8:  12.0.0.1 - 12.255.255.254
- 11111111.11111111.00000000.00000000: 12.167.38.1 - 12.167.38.254
- /255.255.254.0: 12.167.38.1 - 12.167.39.254
- /4: 1 - 254


### 1.2 Localhost.
1. Определить и записать в отчёт, можно ли обратиться к приложению, работающему на localhost, со следующими IP: 194.34.23.100, 127.0.0.2, 127.1.0.1, 128.0.0.1
-  могут 127.0.0.2, 127.1.0.1
- не могут 194.34.23.100, 128.0.0.1
### 1.3 Диапозоны и сегменты сетй.
1. 1) какие из перечисленных IP можно использовать в качестве публичного, а какие только в качестве частных: 10.0.0.45, 134.43.0.2, 192.168.4.2, 172.20.250.4, 172.0.2.1, 192.172.0.1, 172.68.0.2, 172.16.255.255, 10.10.10.10, 192.169.168.1

- Частные адреса начинаются со следующих чисел 10, 127, 169, 172, 192.
- Частыне:  172.16.255.255,   172.20.250.4, 192.168.4.2, 10.0.0.45, 10.10.10.10
- Публичные: 134.43.0.2, 192.169.168.1,192.172.0.1,172.0.2.1,
2. ) какие из перечисленных IP адресов шлюза возможны у сети 10.10.0.0/18: 10.0.0.1, 10.10.0.2, 10.10.10.10, 10.10.100.1, 10.10.1.255
- 10.10.0.0.1, 10.10.0.2, 10.10.10.10, 10.10.1.255 

## Part 2. Статическая маршрутизация между двумя машинами.
1. С помощью команды ip a посмотреть существующие сетевые интерфейсы
![ws1](images/cron3.png)
![ws2](images/cron4.png)
2. Описать сетевой интерфейс, соответствующий внутренней сети, на обеих машинах и задать следующие адреса и маски: ws1 - 192.168.100.10, маска /16, ws2 - 172.24.116.8, маска /12
- ![cat ws1](images/cron6.png)
- ![cat ws2](images/cron5.png)
3. Выполнить команду netplan apply для перезапуска сервиса сети
- ![netplan apply](images/cron7.png)
- ![netplan apply](images/cron8.png)
4. Добавить статический маршрут от одной машины до другой и обратно при помощи команды вида ip r add
- ![ip r add](images/cron9.png))
- ![ip r add](images/cron10.png)
5. Пропиговать соединение между машинами
- ![ping](images/cron11.png)
- ![ping](images/cron12.png)
6. Перезапустить машины reboot
7. Добавить статический маршрут от одной машины до другой с помощью файла etc/netplan/00-installer-config.yaml
- ![mc ws1](images/cron13.png)
- ![mc ws1](images/cron14.png)
8. После добовления маршрута вызваем команду netplan apply Пропинговать 
- ![ping ws1](images/cron15.png)
- ![ping ws2](images/cron16.png)
## Part 3 Утилита iperf3.
1. Перевести и записать в отчёт: 8 Mbps в MB/s, 100 MB/s в Kbps, 1 Gbps в Mbps
 - 8 Mbps  = 1 MB/s
 - 100 MB/s = 819200 Kbps (Kilobit per second)
 - 1 Gbps (Gigabit per second) = 1024 Mbps
2. Измерить скорость соединения между ws1 и ws2
![ws1 speed](images/cron17.png)
![ws2 speed](images/cron18.png)
## Part 4.
1. Создать файл */etc/firewall.sh*, имитирующий фаерволл, на ws1 и ws2:
```shel
#!/bin/sh

# Удаление всех правил в таблице "filter" (по-умолчанию).
iptables –F
iptables -X
```
- ![iptables](images/cron19.png)
- ![iptables](images/cron20.png)
2. В отчёте описать разницу между стратегиями, применёнными в первом и втором файлах.
 - Разница в том, что если сперва идет запрещающее правило, то оно не перезаписывается потом разрешающим правилом.
 3. Утилита nmap
  Командой **ping** найти машину, которая не "пингуется", после чего утилитой **nmap** показать, что хост машины запущен
*Проверка: в выводе nmap должно быть сказано: `Host is up`*
- В отчёт поместить скрины с вызовом и выводом использованных команд **ping** и **nmap**.
 - ![nmap](images/cron21.png)
 - ![nmap](images/cron22.png)
 
 4. Сохранить дампы образов виртуальных машин
- ![save dump](images/cron57.png)
- ![save dump](images/cron58.png)
 ## Part 5 Статическая маршрутизация сети.
 1. Поднять пять виртуальных машин (3 рабочие станции (ws11, ws21, ws22) и 2 роутера(r1,r2))
 2. Настроить конфигурации машин в etc/netplan/00-installer-config.yaml согласно сети на рисунке.
- ![r1](images/cron23.png)
- ![r2](images/cron24.png)
- ![ws11](images/cron25.png)
- ![ws21](images/cron26.png)
- ![ws22](images/cron27.png)
3. Перезапустить сервисы сети.  Если ошибок нет, то командой `ip -4 a` проверить сто адрес машины задан верно. Также пропинговать ws22 с ws21. Аналагично пропинговать r1  c ws11.
- ![r1 ip -4 a](images/cron28.png)
- ![r2 ip -4 a](images/cron29.png)
- ![ws11 ip -4 a](images/cron30.png)
- ![ws21 ip -4 a](images/cron32.png)
- ![ws22 ip -4 a](images/cron31.png)
- ![ping ws22 and ws21](images/cron33.png)
- ![ping r1 and ws11](images/cron34.png)
4. Для включения преадресации IP, выполните команду на роутерах `sysctl -w net.ipv4.ip_forward=1`
- ![r1 sysctl](images/cron35.png)
- ![r2 sysctl](images/cron37.png)
5. Откройте файл /etc/sysctl.conf и добавьте в него следующую строку: net.ipv4.ip_forward = 1
- ![r1 vim sysctl](images/cron39.png)
- ![r2 vim sysctl](images/cron38.png)
6. Установка маршрута по умолчанию
Настроить маршрут по-умолчанию(шлюз) для рабочих станций. Для этого добавить gateway4[ip роутера] в файле конфигураций
- ![add gateway4 ws11](images/cron40.png)
- ![add gateway4 ws21](images/cron41.png)
- ![add gateway4 ws22](images/cron42.png)
7. Вызвать ip r и показать, что добавился маршрут в таблицу маршрутизации
- ![ip r ws11](images/cron43.png)
- ![ip r ws21](images/cron44.png)
- ![ip r ws22](images/cron45.png)
8. Пропинговать с ws11 роутер r2 и показать на r2, что пинг доходит. Для этого использовать команду: tcpdump -tn -i eth1
- ![ws11 ip -c 2](images/cron46.png)
- ![tcpdump](images/cron47.png)                    
9. Добавление статических маршрутов
Добавить в роутеры r1 и r2 статические маршруты в файле конфигураций. Пример для r1 маршрута в сетку 10.20.0.0/26
- ![static route r1](images/cron48.png)
- ![static route r2](images/cron49.png)
- ![ip r after route r1](images/cron50.png)
- ![ip r after route r2](images/cron51.png)
10. Запустить команды на ws11:
- ![ip r list ws11](images/cron52.png)
- В отчете выбран путь отличный от 10.10.0.0 потому что этот адрес указывает на все адреса.
11. При помощи утилиты traceroute построить список маршрутизаторов на пути от ws11 до ws21
- ![r1 tcpdump](images/cron53.png)
- ![ws11 traceroute](images/cron54.png)
- Путь строиться от узла к узлу до того момента, покаа не будет достигнута конечная точка. Каждый пакет проходит на своем пути определенное количество узлов, пока достигнет своей цели. На каждом узле добавляется счетчик, который отслеживает количество пройденых узлов.
12. Использование протокола ICMP при маршрутизации.

Запустить на r1 перехват сетевого трафика, проходящего через eth0 с помощью команды:

- ![tcpdump icmp](images/cron56.png)

Пропинговать с ws11 несуществующий IP (например, 10.30.0.111) с помощью команды:
- ![ping ws11](images/cron55.png)
Сохранить дампы образов виртуальных машин
- ![save dump r1](images/cron59.png)
- ![save dump r2](images/cron60.png)
- ![save dump ws11](images/cron61.png)
- ![save dump ws21](images/cron62.png)
- ![save dump ws22](images/cdron63.png)

## Part 6 Динамическая настройка IP с помощью DHCP
Для r2 настроить в файле /etc/dhcp/dhcpd.conf конфигурацию службы DHCP:

1.  Указать адрес маршрутизатора по-умолчанию, DNS-сервер и адрес внутренней сети. Пример файла для r2:
- ![dhcp r2](images/cron64.png)
2. В файле resolv.conf прописать nameserver 8.8.8.8.
Здесь нужно будет изменить три файла
- ![resolf.conf](images/cron65.png)
- ![resolf.conf](images/cron66.png)

2. Перезагрузить службу DHCP командой systemctl restart isc-dhcp-server. Машину ws21 перезагрузить при помощи reboot и через ip a показать, что она получила адрес. Также пропинговать ws22 с ws21.
- ![ip a ws21](images/cron67.png)
- ![ping ws22 n ws21](images/cron69.png)
3. Указать MAC адрес у ws11, для этого в etc/netplan/00-installer-config.yaml надо добавить строки: macaddress: 10:10:10:10:10:BA, dhcp4: true
- ![macadress](images/cron68.png)
4. Для r1 настроить аналогично r2, но сделать выдачу адресов с жесткой привязкой к MAC-адресу (ws11). Провести аналогичные тесты

- ![dhcp r1](images/cron70.png)
- ![resolof r1](images/cron71.png)
- ![system service](images/cron72.png)
- ![ws11 ip a after dhcp](images/cron73.png)
- ![ws11 commands](images/cron74.png)

5. Запросить с ws21 обновление ip адреса

- ![update ip becose ws21](images/cron75.png)
В отчёте описать, какими опциями DHCP сервера пользовались в данном пункте.
Использовались функции привязки фиксированного ip-адреса по конкретному MAC-адресу.
6. Сохранить дампы образов виртуальных машин
<!-- - ![save dumps](images/cron76.png)
- ![save dumps2](images/cron77.png)
- ![save dumps3](images/cron78.png) -->
## Part 7 NAT
1. В файле /etc/apache2/ports.conf на ws22 и r2 изменить строку Listen 80 на Listen 0.0.0.0:80, то есть сделать сервер Apache2 общедоступным

- ![firewall r2](images/cron76.png)
- ![firewall ws22](images/cron77.png)

2.  Запустить веб-сервер Apache командой service apache2 start на ws22 и r1

- ![start apache2 r1](images/cron78.png)
- ![start apache2 ws22](images/cron79.png)

3. Добавить в фаервол, созданный по аналогии с фаерволом из Части 4, на r2 следующие правила:

1) Удаление правил в таблице filter - iptables -F


2) Удаление правил в таблице "NAT" - iptables -F -t nat


3) Отбрасывать все маршрутизируемые пакеты - iptables --policy FORWARD DROP


Запускать файл также, как в Части 4

Проверить соединение между ws22 и r1 командой ping

При запуске файла с этими правилами, ws22 не должна "пинговаться" с r1

- ![add firewall command](images/cron80.png)
- ![not ping with ws22](images/cron81.png)

4. Добавить в файл ещё одно правило:

4) Разрешить маршрутизацию всех пакетов протокола ICMP


Запускать файл также, как в Части 4

Проверить соединение между ws22 и r1 командой ping

При запуске файла с этими правилами, ws22 должна "пинговаться" с r1


- ![add new line](images/cron82.png)
- ![have a bing between](images/cron83.png)

5. Добавить в файл ещё два правила:

5) Включить SNAT, а именно маскирование всех локальных ip из локальной сети, находящейся за r2 (по обозначениям из Части 5 - сеть 10.20.0.0)
Совет: стоит подумать о маршрутизации внутренних пакетов, а также внешних пакетов с установленным соединением

6) Включить DNAT на 8080 порт машины r2 и добавить к веб-серверу Apache, запущенному на ws22, доступ извне сети
Совет: стоит учесть, что при попытке подключения возникнет новое tcp-соединение, предназначенное ws22 и 80 порту

В отчёт поместить скрин с содержанием изменённого файла.

- ![new firewall.sh](images/cron84.png)

Запускать файл также, как в Части 4
Перед тестированием рекомендуется отключить сетевой интерфейс NAT (его наличие можно проверить командой ip a) в VirtualBox, если он включен

Проверить соединение по TCP для SNAT, для этого с ws22 подключиться к серверу Apache на r1 командой:
telnet [адрес] [порт]

Проверить соединение по TCP для DNAT, для этого с r1 подключиться к серверу Apache на ws22 командой telnet (обращаться по адресу r2 и порту 8080)

В отчёт поместить скрины с вызовом и выводом использованных команд.

- ![output snat](images/cron85.png)
- ![output dnat](images/cron86.png)
Сохранить дампы образов виртуальных машин

## Part 8. Дополнительно. Знакомство с SSH Tunnels
Запустить веб-сервер Apache на ws22 только на localhost (то есть не изменять файл /etc/apache2/ports.conf или, если был изменен ранее, вернуть строку Listen 80)

Воспользоваться Local TCP forwarding с ws21 до ws22, чтобы получить доступ к веб-серверу на ws22 с ws21

Воспользоваться Remote TCP forwarding c ws11 до ws22, чтобы получить доступ к веб-серверу на ws22 с ws11

Для проверки, сработало ли подключение в обоих предыдущих пунктах, перейдите во второй терминал (например, клавишами Alt + F2) и выполните команду:
telnet 127.0.0.1 [локальный порт]

В отчёте описать команды, необходимые для выполнения этих четырёх пунктов, а также приложить скриншоты с их вызовом и выводом.
- ![change listen](images/cron88.png)
- ![tcp forwarding](images/cron87.png)
- ![telnet check](images/cron89.png)

- ![tcp remote](images/cron90.png)
- ![tcp check](images/cron91.png)

Сохранить дампы образов виртуальных машин.